From 03cfa1043231cc8091312f46c0d7c6e66dd596fd Mon Sep 17 00:00:00 2001
From: bbcallen <bbcallen@gmail.com>
Date: Mon, 2 Jul 2012 18:16:13 +0800
Subject: [PATCH 03/25] core: support buffer progress

---
 lib/media_player.c |    2 ++
 src/input/event.c  |   10 ++++++++++
 src/input/event.h  |    1 +
 src/input/stream.c |    2 ++
 4 个文件被修改，插入 15 行(+)

diff --git a/lib/media_player.c b/lib/media_player.c
index a2d3be4..94452a2 100644
--- a/lib/media_player.c
+++ b/lib/media_player.c
@@ -528,6 +528,8 @@ libvlc_media_player_new( libvlc_instance_t *instance )
 
     register_event(mp, MediaChanged);
 
+    register_event(mp, BufferingTotal);
+
     /* Attach a var callback to the global object to provide the glue between
      * vout_thread that generates the event and media_player that re-emits it
      * with its own event manager
diff --git a/src/input/event.c b/src/input/event.c
index dec628e..c9de7e4 100644
--- a/src/input/event.c
+++ b/src/input/event.c
@@ -195,6 +195,16 @@ void input_SendEventCache( input_thread_t *p_input, double f_level )
     Trigger( p_input, INPUT_EVENT_CACHE );
 }
 
+void input_SendEventCacheTotal( input_thread_t *p_input, double f_level )
+{
+    vlc_value_t val;
+    
+    val.f_float = f_level;
+    var_Change( p_input, "cache-total", VLC_VAR_SETVALUE, &val, NULL );
+    
+    Trigger( p_input, INPUT_EVENT_CACHE_TOTAL );    
+}
+
 void input_SendEventTotal( input_thread_t *p_input, double f_level )
 {
     vlc_value_t val;
diff --git a/src/input/event.h b/src/input/event.h
index c8f1071..3991453 100644
--- a/src/input/event.h
+++ b/src/input/event.h
@@ -43,6 +43,7 @@ void input_SendEventSeekpoint( input_thread_t *p_input, int i_title, int i_seekp
 void input_SendEventSignal( input_thread_t *p_input, double f_quality, double f_strength );
 void input_SendEventState( input_thread_t *p_input, int i_state );
 void input_SendEventCache( input_thread_t *p_input, double f_level );
+void input_SendEventCacheTotal( input_thread_t *p_input, double f_level );
 
 /* TODO rename Item* */
 void input_SendEventMeta( input_thread_t *p_input );
diff --git a/src/input/stream.c b/src/input/stream.c
index 54d8ca8..e3e454b 100644
--- a/src/input/stream.c
+++ b/src/input/stream.c
@@ -636,6 +636,8 @@ static int AStreamControl( stream_t *s, int i_query, va_list args )
         case STREAM_GET_CONTENT_TYPE:
             return access_Control( p_access, ACCESS_GET_CONTENT_TYPE,
                                     va_arg( args, char ** ) );
+        case STREAM_GET_CACHED_SIZE:
+            return VLC_EGENERIC;
         case STREAM_SET_RECORD_STATE:
         default:
             msg_Err( s, "invalid stream_vaControl query=0x%x", i_query );
-- 
1.7.10.4

