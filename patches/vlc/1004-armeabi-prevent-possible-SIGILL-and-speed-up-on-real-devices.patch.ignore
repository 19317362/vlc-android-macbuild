From a24451d02d9654691a298e97a9a8c8c9a7bbef39 Mon Sep 17 00:00:00 2001
From: tewilove <tewilove@gmail.com>
Date: Wed, 15 Feb 2012 18:18:11 -0800
Subject: [PATCH] armeabi: prevent possible SIGILL and speed up on real
 devices

---
 contrib/src/main.mak                |    4 ++--
 extras/package/android/configure.sh |    2 +-
 2 files changed, 3 insertions(+), 3 deletions(-)

diff --git a/contrib/src/main.mak b/contrib/src/main.mak
index 93d647f..b4487e2 100644
--- a/contrib/src/main.mak
+++ b/contrib/src/main.mak
@@ -107,9 +107,9 @@ CXX := $(HOST)-g++ --sysroot=$(ANDROID_NDK)/platforms/android-9/arch-arm
 EXTRA_CFLAGS += -D__STDC_VERSION__=199901L
 EXTRA_CFLAGS += -I$(ANDROID_NDK)/sources/cxx-stl/gnu-libstdc++/include
 ifdef HAVE_NEON
-    EXTRA_CFLAGS += -I$(ANDROID_NDK)/sources/cxx-stl/gnu-libstdc++/libs/armeabi-v7a/include -mfloat-abi=softfp -mfpu=neon -mcpu=cortex-a8
+    EXTRA_CFLAGS += -I$(ANDROID_NDK)/sources/cxx-stl/gnu-libstdc++/libs/armeabi-v7a/include -mfloat-abi=softfp -mfpu=neon -mcpu=cortex-a8 -funsafe-math-optimizations
 else
-    EXTRA_CFLAGS += -I$(ANDROID_NDK)/sources/cxx-stl/gnu-libstdc++/libs/armeabi/include
+    EXTRA_CFLAGS += -I$(ANDROID_NDK)/sources/cxx-stl/gnu-libstdc++/libs/armeabi/include -msoft-float -mfloat-abi=soft -march=armv6j -mtune=arm1136j-s
 endif
 endif
 
diff --git a/extras/package/android/configure.sh b/extras/package/android/configure.sh
index 920598b..68da78d 100755
--- a/extras/package/android/configure.sh
+++ b/extras/package/android/configure.sh
@@ -19,7 +19,7 @@ if [ -z "$NO_NEON" ]; then
     EXTRA_PARAMS=" --enable-neon"
 else
     CXX_TARGET="armeabi"
-    CFLAGS="$CFLAGS -march=armv6j -mtune=arm1136j-s -msoft-float"
+    CFLAGS="$CFLAGS -march=armv6j -mtune=arm1136j-s -msoft-float -mfloat-abi=soft"
     EXTRA_PARAMS=" --disable-neon"
 fi
 
-- 
1.7.9

